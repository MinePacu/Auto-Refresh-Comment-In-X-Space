# <img src="public/icons/icon_48.png" width="45" align="left"> Auto Refresh Comment In X Space

X (구 트위터) 스페이스 댓글을 자동으로 최신순으로 정렬해주는 Chrome 확장 프로그램입니다.

![Version](https://img.shields.io/badge/version-0.1.0-blue.svg)
![Manifest](https://img.shields.io/badge/manifest-v3-green.svg)
![Chrome](https://img.shields.io/badge/Chrome-Extension-yellow.svg)

> 📌 **주요 기능**: X 스페이스에서 실시간으로 새로운 댓글을 확인할 수 있도록 자동 새로고침 및 최신순 정렬을 제공합니다.

## 🌟 핵심 기능

### 🔄 자동 댓글 정렬
- **스마트 자동화**: X 스페이스의 댓글을 지정된 주기로 자동 최신순 정렬
- **적응형 동작**: 첫 번째 새로고침은 스크롤+맨위이동+버튼클릭, 이후는 버튼클릭만 수행
- **마스터 제어**: ON/OFF 토글로 전체 기능을 간편하게 제어

### ⚙️ 고급 설정
- **새로고침 주기**: 8초~3600초(1시간) 범위에서 정밀 설정 (기본값: 10초)
  - **X Rate Limit 보호**: X API Rate Limit (150 requests/15분)을 고려한 최소 8초 제한
  - **자동 조정**: 제한 미만 값 입력 시 자동으로 안전한 값으로 조정
- **클릭 간 대기시간**: 0ms~10000ms 범위에서 미세 조정 (기본값: 700ms)
- **테마 지원**: 라이트/다크/시스템 설정에 따른 자동 테마 전환
- **탭별 독립 설정**: 각 탭마다 독립적인 마스터 ON/OFF 상태 관리
- **설정 동기화**: Chrome 동기화를 통한 모든 기기 간 설정 공유

### 🎯 인텔리전트 감지
- **페이지 감지**: X 스페이스 상세 페이지 자동 인식
- **상태 인식**: 스페이스 청취 상태 실시간 감지 (참여했습니다/일시정지 상태 구분)
- **조건부 실행**: 모든 조건 충족 시에만 자동 활성화
- **SPA 지원**: 페이지 이동 시 즉시 상태 반영 및 자동 제어
- **탭별 독립 운영**: 여러 탭에서 각각 독립적으로 동작
- **백그라운드 관리**: 탭 생성/제거 시 자동 설정 관리

### 🚀 사용자 경험
- **무음 모드**: 마스터 OFF 시 완전한 조용한 상태 유지
- **실시간 피드백**: 상태별 명확한 메시지 표시 (답글 개수 포함)
- **오류 처리**: 네트워크 오류 및 통신 실패 시 안정적인 fallback
- **즉시 응답**: 마스터 상태 변경 시 즉시 시작/중단
- **Rate Limit 보호**: X API 제한 초과 방지를 위한 자동 간격 조정
- **시각적 피드백**: 설정 조정 시 즉시 알림 및 상태 표시

## 🚀 설치 방법

### Chrome 웹스토어에서 설치 (권장)
[**Chrome Extension**](링크_추가_예정)

### 개발자 모드로 설치
1. 이 저장소를 다운로드하거나 클론합니다
2. `npm install`로 의존성을 설치합니다
3. `npm run build`로 확장 프로그램을 빌드합니다
4. Chrome에서 `chrome://extensions` 페이지를 엽니다
5. 개발자 모드를 활성화합니다
6. "압축해제된 확장 프로그램을 로드합니다"를 클릭합니다
7. `build` 폴더를 선택합니다

## 📖 사용법

### 1. 기본 사용
1. **X 접속**: X(트위터)에 로그인하여 접속합니다
2. **스페이스 진입**: 원하는 스페이스의 상세 페이지로 이동합니다
3. **확장 프로그램 실행**: 브라우저 상단의 확장 프로그램 아이콘을 클릭합니다
4. **마스터 활성화**: 팝업에서 **마스터 버튼**을 `ON`으로 설정합니다
5. **자동 정렬 시작**: 모든 조건이 충족되면 댓글이 자동으로 최신순 정렬됩니다

### 2. 상태 메시지 이해하기
- **상태: 활성 중 (답글: N개)**: 정상 작동 중 (댓글 자동 정렬 실행)
- **상태: 비활성**: 마스터 OFF 상태 (모든 기능 정지)  
- **상태: X 사이트가 아님**: X 사이트가 아닌 페이지에 있음
- **상태: 스페이스 트윗이 아님**: X에는 접속했으나 스페이스 상세 페이지가 아님
- **상태: 스페이스 청취 중이 아님**: 스페이스 페이지에는 있으나 청취 상태가 아님
- **조정됨: N초**: Rate Limit으로 인해 새로고침 간격이 자동 조정됨

> 💡 **팁**: 실시간 상태 확인을 위해 팝업을 열어두면 1초마다 상태가 업데이트됩니다.

### 3. 고급 설정
#### 새로고침 주기 조정
- 값 입력 후 **"적용"** 버튼 클릭
- **최소값**: 8초 (X Rate Limit 정책에 따른 제한)
- **권장값**: 10-30초 (네트워크 상황에 따라 조정)
- **자동 조정**: 8초 미만 입력 시 자동으로 8초로 설정
- **Rate Limit 보호**: X API 제한(150 requests/15분)을 고려한 안전한 간격 유지

#### 클릭 간 대기시간 조정
- 값 입력 후 **"적용"** 버튼 클릭
- **권장값**: 500-1000ms (컴퓨터 성능에 따라 조정)
- **용도**: UI 버튼 클릭 사이의 안정적인 대기시간 확보

#### 테마 선택
- **라이트**: 밝은 테마 (기본)
- **다크**: 어두운 테마
- **시스템 설정**: 운영체제 설정에 따라 자동 전환

### 4. 문제 해결
- **기능이 작동하지 않는 경우**: 마스터를 OFF → ON으로 다시 설정
- **상태가 업데이트되지 않는 경우**: 팝업을 닫았다가 다시 열기
- **설정이 저장되지 않는 경우**: Chrome 동기화 설정 확인

## 🛠️ 개발

### 개발 환경 설정
```bash
# 저장소 클론
git clone <repository-url>
cd Auto-Refresh-Comment-In-X-Space-1

# 의존성 설치
npm install

# 개발 모드 (파일 변경 감지)
npm run watch

# 프로덕션 빌드
npm run build
```

### 프로젝트 구조
```
├── src/
│   ├── popup.js          # 팝업 UI 로직 (설정, 상태 표시, 테마, Rate Limit 검증)
│   ├── popup.css         # 팝업 스타일 (테마 변수, 반응형)
│   ├── background.js     # 백그라운드 스크립트 (탭 관리, 설정 정리)
│   └── contentScript.js  # 콘텐츠 스크립트 (메인 로직, 클래스 기반 구조)
├── public/
│   ├── manifest.json     # 확장 프로그램 설정
│   ├── popup.html        # 팝업 HTML
│   └── icons/            # 아이콘 파일들 (16, 32, 48, 128px)
├── config/
│   ├── webpack.common.js # 공통 Webpack 설정
│   ├── webpack.config.js # 프로덕션 설정
│   └── paths.js         # 경로 설정
├── build/                # 빌드된 파일들 (배포용)
└── node_modules/         # 의존성 모듈들
```

### 주요 기술 스택
- **JavaScript (ES6+)**: 메인 로직 구현 및 클래스 기반 아키텍처
- **Chrome Extension Manifest V3**: 최신 확장 프로그램 API 및 Service Worker
- **Webpack 5**: 모듈 번들링, 최적화 및 개발 환경 지원
- **CSS Variables**: 동적 테마 시스템 (라이트/다크/시스템 모드)
- **Chrome Storage API**: 탭별 독립 설정 및 전역 설정 동기화
- **XPath Selectors**: 정확한 DOM 요소 선택 및 X UI 변경 대응

### 핵심 구조 설명

#### ContentScript (contentScript.js)
- **주요 역할**: X 스페이스 페이지에서 실제 댓글 정렬 작업 수행
- **클래스 기반 구조**: `XSpaceAutoRefresh` 클래스로 모든 기능을 캡슐화
- **핵심 상수**: Rate Limit 정책, XPath 선택자, 스크롤 설정 등 중앙 관리
- **감지 기능**: 
  - 페이지 상태 실시간 모니터링 (1초마다)
  - 스페이스 청취 상태 감지 (`참여했습니다`/`일시정지` 구분)
  - SPA 지원을 위한 URL 및 DOM 변경 감지
- **자동화 로직**:
  - 조건 충족 시 자동 시작/중단
  - **첫 번째 새로고침**: 스크롤 다운(500px) → 맨위 이동 → 버튼 클릭 시퀀스
  - **이후 새로고침**: 버튼 클릭만으로 효율성 최적화
  - 마스터 OFF 시 완전 정지 및 리소스 정리
- **Rate Limit 보호**: X API 제한(150 requests/15분)을 고려한 최소 7.2초 간격 검증
- **오류 처리**: 네트워크 오류, 요소 부재 시 안정적인 fallback 및 재시도

#### Popup (popup.js + popup.html + popup.css)
- **주요 역할**: 사용자 인터페이스 및 설정 관리
- **실시간 상태 표시**: 1초마다 Content Script와 통신하여 상태 업데이트
- **설정 관리**: 
  - 탭별 독립 마스터 ON/OFF 상태 (`masterOn_tab_{tabId}`)
  - 전역 설정 (새로고침 주기, 클릭 대기시간, 테마)
  - Chrome Storage Sync를 통한 기기 간 동기화
- **입력 검증**: 
  - 새로고침 주기 실시간 유효성 검사 (8초~3600초)
  - Rate Limit 위반 시 자동 조정 및 시각적 피드백
- **테마 시스템**: CSS Variables 기반 다크/라이트/시스템 모드 지원
- **시각적 피드백**: 설정 변경, 조정, 오류 시 상태 텍스트 색상 변경 및 스피너 표시

#### Background (background.js)
- **Service Worker 기반**: Manifest V3 호환 백그라운드 처리
- **탭 생명주기 관리**: 
  - 탭 로딩 완료 시 Content Script에 실제 탭 ID 전달
  - 탭 닫힘 시 해당 탭 설정 자동 정리 (`_tab_{tabId}` 패턴)
- **메시지 라우팅**: Popup ↔ Content Script 간 통신 중계
- **초기 설정**: 확장 프로그램 최초 설치 시 기본값 설정 (`theme: 'system'`)

### 🐛 디버깅 및 개발자 도구

#### Chrome 개발자 도구에서 디버깅
```javascript
// 콘솔에서 확인할 수 있는 디버그 로그들
[Tab 123] DEBUG: Starting detection cycle
[Tab 123] DEBUG: All conditions met, starting refresh cycle  
[Tab 123] DEBUG: isFirstRefresh = true
[Tab 123] Performing FIRST refresh actions - including scroll and go to top
[Tab 123] DEBUG: Starting scroll down action
[Tab 123] Scrolled 500px (before: 0px, after: 500px)
[Tab 123] DEBUG: Starting go to top action
[Tab 123] Scrolled to top of page (before: 500px, after: 0px)
```

#### 주요 상수 및 설정값
```javascript
// contentScript.js의 주요 상수들
DETECTION_INTERVAL: 1000          // 감지 주기 (1초)
DEFAULT_REFRESH_INTERVAL: 10000   // 기본 새로고침 주기 (10초)
MIN_REFRESH_INTERVAL: 7200        // 최소 새로고침 주기 (7.2초)
SCROLL_AMOUNT: 500               // 스크롤 픽셀 수
MIN_REPLY_COUNT: 10              // 최소 답글 수 요구사항
```

#### Storage 구조
```javascript
// Chrome Storage에 저장되는 데이터 구조
{
  // 전역 설정
  "refreshInterval": 10,           // 새로고침 주기 (초)
  "clickDelayMs": 700,            // 클릭 간 대기시간 (ms)
  "theme": "system",              // 테마 설정
  
  // 탭별 설정 (예: 탭 ID가 123인 경우)
  "masterOn_tab_123": true        // 해당 탭의 마스터 ON/OFF 상태
}
```

## ⚙️ 설정 옵션

| 설정 | 범위 | 기본값 | 설명 | 권장값 |
|------|------|--------|------|--------|
| **마스터 토글** | ON/OFF | OFF | 탭별 독립적인 기능 활성화/비활성화 | 사용 시 ON |
| **새로고침 주기** | 8-3600초 | 10초 | 댓글 정렬 반복 주기 (Rate Limit 보호) | 10-30초 |
| **클릭 간 대기시간** | 1-10000ms | 700ms | UI 요소 클릭 사이 지연시간 | 500-1000ms |
| **테마** | 라이트/다크/시스템 | 시스템 | 팝업 UI 테마 설정 | 개인 취향 |

### 설정 상세 설명

#### 새로고침 주기 (Refresh Interval)
- **용도**: 댓글 목록을 다시 최신순으로 정렬하는 주기
- **최소값**: 8초 (X Rate Limit 정책: 150 requests/15분 고려)
- **최대값**: 3600초 (1시간, 거의 수동에 가까움)
- **자동 조정**: 8초 미만 입력 시 자동으로 8초로 조정되며 시각적 알림 제공
- **성능 고려사항**:
  - 8-10초: 높은 네트워크 사용량, 매우 빠른 업데이트
  - 10-30초: 균형잡힌 사용량 (권장)
  - 30초 이상: 낮은 사용량, 느린 업데이트

#### 클릭 간 대기시간 (Click Delay)
- **용도**: '답글 설정' 버튼 클릭 후 '최신순 정렬' 버튼 클릭 전 대기시간
- **최솟값**: 1ms (1ms 미만 입력 시 자동으로 1ms로 조정)
- **목적**: UI 렌더링 완료 대기 및 안정적인 클릭 보장
- **조정 기준**:
  - 컴퓨터가 느린 경우: 1000ms 이상
  - 일반적인 경우: 700ms (기본값)
  - 빠른 컴퓨터: 300-500ms

#### 테마 시스템
- **라이트 모드**: 밝은 배경, 어두운 텍스트
- **다크 모드**: 어두운 배경, 밝은 텍스트
- **시스템 설정**: OS의 다크/라이트 모드 설정을 자동으로 따름

### 🔄 새로고침 주기별 동작 로직
X 스페이스에서 효율적인 댓글 관리를 위해 첫 번째와 이후 새로고침 주기의 동작이 다르게 설계되었습니다:

#### 첫 번째 새로고침 주기
1. **스크롤 다운**: 페이지 하단으로 이동하여 새로운 댓글 로드
2. **맨위 이동**: 페이지 상단으로 스크롤하여 UI 버튼에 접근 가능한 위치로 이동
3. **답글 설정 버튼 클릭**: 댓글 정렬 옵션 메뉴 열기
4. **최신순 정렬 버튼 클릭**: 댓글을 최신순으로 정렬

#### 이후 새로고침 주기들
1. **답글 설정 버튼 클릭**: 댓글 정렬 옵션 메뉴 열기
2. **최신순 정렬 버튼 클릭**: 댓글을 최신순으로 정렬
   
*스크롤 동작은 생략하여 불필요한 페이지 이동을 방지하고 사용자 경험을 개선합니다.*

#### 동작 로직 장점
- **효율성**: 첫 번째 로드 후에는 불필요한 스크롤 제거
- **사용자 경험**: 반복적인 페이지 이동으로 인한 불편함 최소화
- **성능**: 스크롤 동작 감소로 브라우저 리소스 절약
- **안정성**: 페이지 위치 변화를 최소화하여 오류 가능성 감소

## 🚨 주의사항 및 제한사항

### 🎯 작동 조건
- **필수 조건**: X (구 트위터) 스페이스 상세 페이지에서만 작동
- **스페이스 상태**: 실제로 스페이스를 청취하고 있을 때만 자동 실행 ("참여했습니다" 상태)
- **페이지 감지**: URL 패턴과 DOM 요소를 통한 정확한 페이지 인식
- **탭별 독립**: 각 탭마다 독립적으로 동작하며 다른 탭에 영향 없음

### ⚡ 성능 고려사항
- **Rate Limit 보호**: X API Rate Limit (150 requests/15분)을 고려한 최소 8초 간격 제한
- **자동 조정**: 과도하게 짧은 주기 설정 시 자동으로 안전한 값으로 조정
- **시각적 피드백**: 설정 조정 시 즉시 알림으로 사용자에게 변경사항 통지
- **권장 설정**: 10-30초 주기로 사용하여 성능과 기능의 균형 유지

### 🔧 기술적 제한사항
- **X UI 변경**: X의 인터페이스 업데이트 시 일시적으로 작동하지 않을 수 있음
- **XPath 의존성**: DOM 구조 변경 시 XPath 업데이트 필요
- **네트워크 의존성**: 느린 인터넷 연결 시 클릭 간 대기시간 조정 필요
- **Rate Limit 준수**: X API 제한을 넘지 않도록 최소 간격 자동 조정

### 🛡️ 개인정보 및 보안
- **로컬 저장**: 모든 설정은 브라우저 내부에만 저장됨
- **외부 통신 없음**: 확장 프로그램 자체적으로 외부 서버와 통신하지 않음
- **권한 최소화**: 필요한 최소한의 Chrome API만 사용

### 🔍 문제 해결 팁
1. **기능이 멈춘 경우**:
   - 마스터를 OFF → ON으로 토글
   - 페이지 새로고침 후 다시 시도

2. **느린 동작**:
   - 클릭 간 대기시간을 늘려보기 (1000ms 이상)
   - 새로고침 주기를 늘려보기 (30초 이상)

3. **Rate Limit 경고**:
   - 8초 미만 설정 시 자동 조정되는 것은 정상 동작
   - 시각적 알림(주황색 텍스트)은 3초 후 자동 사라짐

4. **상태가 업데이트되지 않는 경우**:
   - 팝업을 닫았다가 다시 열기
   - Chrome 확장 프로그램 페이지에서 재활성화

## 🤝 기여하기

### 🐛 버그 리포트
버그를 발견하셨나요? 다음 정보를 포함하여 이슈를 등록해주세요:
- **Chrome 버전**: `chrome://version/`에서 확인
- **확장 프로그램 버전**: 0.1.0 (현재)
- **재현 단계**: 구체적인 단계별 설명
- **예상 결과 vs 실제 결과**: 명확한 비교
- **콘솔 로그**: F12 → Console 탭의 오류 메시지
- **X 페이지 URL**: 문제가 발생한 스페이스 URL (개인정보 제외)

### 💡 기능 제안
새로운 기능 아이디어가 있으시나요?
- **기능 설명**: 구체적인 기능 내용
- **사용 사례**: 어떤 상황에서 유용한지
- **예상 이점**: 사용자에게 제공할 가치
- **기술적 고려사항**: Rate Limit, 성능 등

#### 코딩 가이드라인
- **ES6+ 문법** 사용 
- **클래스 기반** 구조 유지
- **상세한 주석** 작성 (JSDoc 스타일)
- **Rate Limit 고려** 필수
- **디버그 로그** 추가 권장


## 📄 라이선스

이 프로젝트는 **MIT 라이선스** 하에 배포됩니다. 자세한 내용은 `LICENSE` 파일을 참조하세요.

### MIT 라이선스 주요 내용
- ✅ 상업적 사용 가능
- ✅ 수정 및 배포 자유
- ✅ 개인적 사용 가능
- ✅ 라이선스 및 저작권 고지 필수

## 🙏 크레딧

### 기반 프로젝트
이 프로젝트는 [Chrome Extension CLI](https://github.com/dutiyesh/chrome-extension-cli)를 기반으로 제작되었습니다.

### 사용된 기술
- **Chrome Extension APIs**: 확장 프로그램 핵심 기능 (Storage, Tabs, Runtime)
- **Webpack 5**: 모듈 번들링, 개발 환경 및 최적화
- **CSS Variables**: 동적 테마 시스템 및 반응형 디자인
- **XPath**: DOM 요소 정확한 선택 및 X UI 변경 대응
- **ES6+ Classes**: 객체지향 프로그래밍 및 코드 구조화

## 📞 연락처 및 지원

### 🆘 문제 해결
**문제가 발생하시나요?** 
- 📋 [Issues 페이지](https://github.com/your-repo/issues)에서 문제를 신고해주세요
- 🔍 기존 이슈를 먼저 검색해보세요
- 💬 상세한 정보를 제공해주시면 빠른 해결이 가능합니다

### 📈 업데이트 정보
- 새로운 기능 및 버그 수정 사항은 [Releases](https://github.com/your-repo/releases)에서 확인하세요
- 중요한 업데이트는 확장 프로그램을 통해 자동 알림됩니다


---

</div>

<div align="center">
